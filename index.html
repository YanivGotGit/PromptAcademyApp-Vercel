<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×”××§×“××™×” ×œ×¤×¨×•××¤×˜×™×: ×”××“×¨×™×š ×”××œ×</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; scroll-behavior: smooth; background-color: #f8fafc; }
        .gradient-text { background: -webkit-linear-gradient(45deg, #6d28d9, #4f46e5); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card { background: white; border-radius: 1.5rem; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card:hover { transform: translateY(-8px); box-shadow: 0 20px 30px -10px rgba(99, 102, 241, 0.15); }
        .btn { transition: all 0.3s ease; }
        .btn-primary { background-color: #6366f1; color: white; }
        .btn-primary:hover { background-color: #4f46e5; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); }
        .btn-secondary { background-color: #eef2ff; color: #4f46e5; }
        .btn-secondary:hover { background-color: #e0e7ff; }
        .loader { border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #fff; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        .radio-card { border: 2px solid #e5e7eb; border-radius: 1rem; padding: 1.5rem; cursor: pointer; transition: all 0.2s ease; }
        .radio-card:hover { border-color: #a5b4fc; }
        .radio-card.selected { border-color: #6366f1; background-color: #eef2ff; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="text-gray-800">

    <div id="app">
        <!-- Main Screen -->
        <main id="mainScreen" class="container mx-auto px-4 py-12 min-h-screen flex items-center">
            <div class="text-center w-full">
                <h1 class="text-4xl md:text-6xl font-bold mb-4">
                    <span class="gradient-text">×”××§×“××™×” ×œ×¤×¨×•××¤×˜×™×</span>
                </h1>
                <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto mb-12">×”××“×¨×™×š ×”××œ× ×œ×‘× ×™×™×ª ×¤×¨×•××¤×˜×™×: ××”×•×¨××” ×¤×©×•×˜×” ×œ×™×•×-×™×•× ×•×¢×“ ×œ××¡×˜×¨×˜×’×™×” ××§×¦×•×¢×™×ª ×œ××©×™××•×ª ××•×¨×›×‘×•×ª. ×‘×—×¨ ××ª ×”×›×œ×™ ×”××ª××™× ×œ×š.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                    <!-- Quick Builder Card -->
                    <div class="card p-8 text-center flex flex-col">
                        <div class="text-5xl mb-4">âš¡ï¸</div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-3">×”×‘×•× ×” ×”××”×™×¨</h2>
                        <p class="text-gray-600 mb-6 flex-grow">×¦×¨×™×š ×¤×¨×•××¤×˜ ××™×›×•×ª×™ ×œ××©×™××” ×™×•××™×•××™×ª? ×¢× ×” ×¢×œ ×›××” ×©××œ×•×ª ×¤×©×•×˜×•×ª ×•×§×‘×œ ×¤×¨×•××¤×˜ ××“×•×™×§ ×ª×•×š ×©× ×™×•×ª.</p>
                        <button onclick="switchView('quickBuilderScreen')" class="btn btn-secondary font-bold py-3 px-6 rounded-xl text-lg w-full">×œ××©×™××•×ª ×™×•××™×•××™×•×ª</button>
                    </div>
                    
                    <!-- Strategy Lab Card -->
                    <div class="card p-8 text-center flex flex-col">
                        <div class="text-5xl mb-4">ğŸ”¬</div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-3">××¢×‘×“×ª ×”××¡×˜×¨×˜×’×™×”</h2>
                        <p class="text-gray-600 mb-6 flex-grow">×œ××©×™××•×ª ××•×¨×›×‘×•×ª ×”×“×•×¨×©×•×ª × ×™×ª×•×— ××¢××™×§. ×œ××“ ×œ×‘× ×•×ª ×¤×¨×•××¤×˜-×¢×œ ××§×¦×•×¢×™, ×©×œ×‘ ××—×¨ ×©×œ×‘, ×•×œ×”×‘×™×Ÿ ××ª ×”××¡×˜×¨×˜×’×™×” ×©×××—×•×¨×™×•.</p>
                        <button onclick="switchView('strategyLabScreen')" class="btn btn-primary font-bold py-3 px-6 rounded-xl text-lg w-full">×œ××©×™××•×ª ××•×¨×›×‘×•×ª</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Quick Builder Screen -->
        <div id="quickBuilderScreen" class="hidden">
            <div class="container mx-auto px-4 py-12">
                <button onclick="switchView('mainScreen')" class="mb-8 text-indigo-600 hover:text-indigo-800 font-semibold">â†’ ×—×–×¨×” ×œ××¡×š ×”×¨××©×™</button>
                <div class="max-w-2xl mx-auto">
                    <div class="text-center mb-10">
                        <h1 class="text-4xl font-bold gradient-text mb-2">×”×‘×•× ×” ×”××”×™×¨ âš¡ï¸</h1>
                        <p class="text-lg text-gray-600">×‘× ×” ×¤×¨×•××¤×˜ ×™×¢×™×œ ×œ××©×™××•×ª ×™×•××™×•××™×•×ª.</p>
                    </div>
                    <div class="card p-8 space-y-6">
                        <div>
                            <label for="qbTask" class="font-bold text-lg text-gray-700 mb-2 block">1. ××” ×”××©×™××” ×©×œ×š?</label>
                            <textarea id="qbTask" class="w-full h-24 p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition" placeholder="×œ×“×•×’××”: ×›×ª×•×‘ ×œ×™ ××™×™×œ ×ª×•×“×” ×œ×‘×•×¡ ×¢×œ ×”×¢×œ××” ×‘×©×›×¨"></textarea>
                        </div>
                        <div>
                            <label for="qbAudience" class="font-bold text-lg text-gray-700 mb-2 block">2. ×œ××™ ×”×ª×•×›×Ÿ ××™×•×¢×“?</label>
                            <input type="text" id="qbAudience" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition" placeholder="×œ×“×•×’××”: ×”×‘×•×¡ ×©×œ×™, ×™×œ×“ ×‘×Ÿ 10, ×§×”×œ ×˜×›× ×™">
                        </div>
                        <div>
                            <label for="qbDetails" class="font-bold text-lg text-gray-700 mb-2 block">3. ×¤×¨×˜×™× × ×•×¡×¤×™× (××•×¤×¦×™×•× ×œ×™)</label>
                            <textarea id="qbDetails" class="w-full h-20 p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition" placeholder="×›×œ×œ×™× ×—×©×•×‘×™×, ×¡×’× ×•×Ÿ ×¨×¦×•×™, ××•×¨×š, ×•×›×•'"></textarea>
                        </div>
                        <button id="qbBuildBtn" class="w-full btn btn-primary font-bold py-3 px-6 rounded-xl text-lg flex items-center justify-center">
                            <span id="qbBuildBtnText">×‘× ×” ×œ×™ ×¤×¨×•××¤×˜!</span>
                            <div id="qbBuildBtnLoader" class="loader hidden"></div>
                        </button>
                    </div>
                    <div id="qbResultContainer" class="mt-8 card p-8 hidden">
                        <h3 class="text-2xl font-bold mb-4">×”×¤×¨×•××¤×˜ ×©×œ×š ××•×›×Ÿ:</h3>
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <pre id="qbResult" class="whitespace-pre-wrap text-gray-800"></pre>
                        </div>
                        <button onclick="copyToClipboard('qbResult')" class="btn btn-secondary w-full mt-4 font-semibold">×”×¢×ª×§ ×¤×¨×•××¤×˜</button>
                    </div>
                    <div id="qbErrorContainer" class="mt-8 p-4 bg-red-100 border border-red-300 text-red-700 rounded-xl hidden">
                        ××•×¤×¡! ××©×”×• ×”×©×ª×‘×©. ×× × ×•×“× ×©××¤×ª×— ×”-API ×©×œ×š ×”×•×’×“×¨ × ×›×•×Ÿ ×•× ×¡×” ×©×•×‘.
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategy Lab Screen -->
        <div id="strategyLabScreen" class="hidden">
            <div class="container mx-auto px-4 py-12">
                 <button onclick="switchView('mainScreen')" class="mb-8 text-indigo-600 hover:text-indigo-800 font-semibold">â†’ ×—×–×¨×” ×œ××¡×š ×”×¨××©×™</button>
                 <div class="max-w-3xl mx-auto">
                    <div class="text-center mb-10">
                        <h1 class="text-4xl font-bold gradient-text mb-2">××¢×‘×“×ª ×”××¡×˜×¨×˜×’×™×” ğŸ”¬</h1>
                        <p class="text-lg text-gray-600">×‘× ×” ×¤×¨×•××¤×˜-×¢×œ ×œ××©×™××•×ª ××•×¨×›×‘×•×ª ×•×œ××“ ××ª ×”×¢×§×¨×•× ×•×ª ×©×××—×•×¨×™×•.</p>
                    </div>
                    <div class="card p-8 space-y-8">
                        <!-- Step 1 -->
                        <div>
                            <h3 class="text-xl font-bold mb-3">×©×œ×‘ 1: ×”×’×“×¨ ××ª ××©×™××ª ×”×œ×™×‘×”</h3>
                            <textarea id="slTask" class="w-full h-24 p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition" placeholder="×œ×“×•×’××”: × ×ª×— ××ª ×ª×•×¨×ª ×”××™×“××•×ª ×©×œ ××¤×œ×˜×•×Ÿ"></textarea>
                        </div>
                        <!-- Step 2 -->
                        <div>
                            <h3 class="text-xl font-bold mb-3">×©×œ×‘ 2: ×‘×—×¨ ××¡×˜×¨×˜×’×™×™×ª ×¤×¨×¡×•× ×”</h3>
                            <div id="slPersonaOptions" class="space-y-4">
                                <div class="radio-card" data-value="simulation">
                                    <h4 class="font-bold text-lg">ğŸ‘¤ ×¤×¨×¡×•× ×ª ×¡×™××•×œ×¦×™×”</h4>
                                    <p class="text-sm text-gray-600">×œ××©×™××•×ª ×™×¦×™×¨×ª×™×•×ª ×•×—×™×§×•×™ ×¡×’× ×•×Ÿ. ×œ×“×•×’××”: "×›×ª×•×‘ ×©×™×¨ ×‘×¡×’× ×•×Ÿ ×©×œ ××©×•×¨×¨ ××¡×•×™×", "×¢× ×” ×›××• ×“××•×ª ×”×™×¡×˜×•×¨×™×ª".</p>
                                </div>
                                <div class="radio-card selected" data-value="interpreter">
                                    <h4 class="font-bold text-lg">ğŸ‘¨â€ğŸ« ×¤×¨×¡×•× ×ª "×”×¤×¨×©×Ÿ ×”×× ×œ×™×˜×™"</h4>
                                    <p class="text-sm text-gray-600">×œ× ×™×ª×•×— ××§×“××™, ×¤×™×¨×•×§ ×•×”×¡×‘×¨×” ×©×œ ×ª×™××•×¨×™×•×ª ××•×¨×›×‘×•×ª ×‘××•×¤×Ÿ ×‘×”×™×¨ ×•××•×‘× ×”.</p>
                                </div>
                                <div class="radio-card" data-value="joker">
                                    <h4 class="font-bold text-lg">ğŸƒ ×¤×¨×¡×•× ×ª ×”"×’'×•×§×¨" (Gemini)</h4>
                                    <p class="text-sm text-gray-600">×œ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª ×¡×‘×•×›×•×ª, ×—×©×™×‘×” ×¨×‘-×ª×—×•××™×ª ×•× ×™×ª×•×— ××•×‘×™×™×§×˜×™×‘×™ ×œ×œ× ××’×‘×œ×•×ª ×©×œ ×“××•×ª.</p>
                                </div>
                            </div>
                        </div>
                         <!-- Step 3 -->
                        <div>
                            <h3 class="text-xl font-bold mb-3">×©×œ×‘ 3: ×§×‘×¢ ××ª ×›×œ×œ×™ ×”××©×—×§</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
                                    <label for="slAddSkeleton" class="font-semibold text-gray-700">×”×•×¡×£ ×©×œ×“ ×¨×¢×™×•× ×™ ××§×“×™×?</label>
                                    <input type="checkbox" id="slAddSkeleton" class="h-6 w-6 rounded text-indigo-600 focus:ring-indigo-500">
                                </div>
                                 <div class="bg-gray-50 p-3 rounded-lg">
                                    <label for="slSourceProtocol" class="font-semibold text-gray-700 block mb-2">×¨××ª ×“×™×•×§ ×”××§×•×¨×•×ª:</label>
                                    <select id="slSourceProtocol" class="w-full p-2 border border-gray-300 rounded-md">
                                        <option value="general">×›×œ×œ×™×ª</option>
                                        <option value="academic">××§×“××™×ª-××—××™×¨×”</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <button id="slBuildBtn" class="w-full btn btn-primary font-bold py-3 px-6 rounded-xl text-lg flex items-center justify-center">
                            <span id="slBuildBtnText">×‘× ×” ×œ×™ ××¡×˜×¨×˜×’×™×” ×•×¤×¨×•××¤×˜!</span>
                            <div id="slBuildBtnLoader" class="loader hidden"></div>
                        </button>
                    </div>

                    <div id="slResultContainer" class="mt-8 card p-8 hidden">
                        <h3 class="text-2xl font-bold mb-4">×”××¡×˜×¨×˜×’×™×” ×•×”×¤×¨×•××¤×˜ ×©×œ×š:</h3>
                        <!-- Strategy Explanation -->
                        <div class="mb-6 p-4 bg-amber-50 border-l-4 border-amber-400">
                            <h4 class="font-bold text-lg text-amber-800 mb-2">×××—×•×¨×™ ×”×§×œ×¢×™×: ×”××¡×˜×¨×˜×’×™×” ×©×‘×—×¨× ×•</h4>
                            <p id="slStrategy" class="text-amber-700"></p>
                        </div>
                        <!-- Generated Prompt -->
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <pre id="slResult" class="whitespace-pre-wrap text-gray-800"></pre>
                        </div>
                        <button onclick="copyToClipboard('slResult')" class="btn btn-secondary w-full mt-4 font-semibold">×”×¢×ª×§ ×¤×¨×•××¤×˜</button>
                    </div>
                    <div id="slErrorContainer" class="mt-8 p-4 bg-red-100 border border-red-300 text-red-700 rounded-xl hidden">
                         ××•×¤×¡! ××©×”×• ×”×©×ª×‘×© ×‘×ª×§×©×•×¨×ª ×¢× ×”-API. ×× × ×•×“× ×©××¤×ª×— ×”-API ×©×œ×š ×”×•×’×“×¨ × ×›×•×Ÿ ×‘-Vercel ×•× ×¡×” ×©×•×‘.
                    </div>

                 </div>
            </div>
        </div>
    </div>

    <script>
        const views = ['mainScreen', 'quickBuilderScreen', 'strategyLabScreen'];
        function switchView(targetView) {
            views.forEach(viewId => {
                const el = document.getElementById(viewId);
                if (viewId === targetView) {
                    el.classList.remove('hidden');
                    el.classList.add('fade-in');
                } else {
                    el.classList.add('hidden');
                }
            });
            window.scrollTo(0, 0);
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = text;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            alert('×”×¤×¨×•××¤×˜ ×”×•×¢×ª×§!');
        }
        
        async function callVercelFunction(metaPrompt, errorContainerId) {
             const errorContainer = document.getElementById(errorContainerId);
             errorContainer.classList.add('hidden');
            
             try {
                 const response = await fetch('/api/gemini', {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify({ prompt: metaPrompt }),
                 });

                 if (!response.ok) {
                     const errorBody = await response.text();
                     throw new Error(`Serverless function failed with status ${response.status}: ${errorBody}`);
                 }

                 const result = await response.json();
                 if (result.error) {
                      throw new Error(`API Error: ${result.error}`);
                 }
                 return result.text;
             } catch(e) {
                 console.error("Error calling serverless function:", e);
                 errorContainer.classList.remove('hidden');
                 throw e;
             }
        }
        
        // --- Quick Builder Logic ---
        const qbBuildBtn = document.getElementById('qbBuildBtn');
        const qbBuildBtnText = document.getElementById('qbBuildBtnText');
        const qbBuildBtnLoader = document.getElementById('qbBuildBtnLoader');
        
        qbBuildBtn.addEventListener('click', async () => {
            const task = document.getElementById('qbTask').value.trim();
            if (!task) {
                alert('×™×© ×œ×”×’×“×™×¨ ××ª ×”××©×™××”.');
                return;
            }

            qbBuildBtnText.classList.add('hidden');
            qbBuildBtnLoader.classList.remove('hidden');
            qbBuildBtn.disabled = true;

             const metaPrompt = `
                 You are a prompt engineering expert. Your task is to generate a simple but effective prompt for a user based on their daily task.
                 The prompt should follow the "Persona, Task, Rules" structure.
                 User's Task: "${document.getElementById('qbTask').value.trim()}"
                 Target Audience: "${document.getElementById('qbAudience').value.trim() || '×›×œ×œ×™'}"
                 Additional Details: "${document.getElementById('qbDetails').value.trim() || '××™×Ÿ'}"
                 
                 Generate the final prompt in Hebrew. Return only the prompt itself.
             `;

            try {
                const resultText = await callVercelFunction(metaPrompt, 'qbErrorContainer');
                console.log("Quick Builder Response:", resultText); // ×œ×•×’ ×œ×‘×“×™×§×”
                
                document.getElementById('qbResult').textContent = resultText.trim();
                document.getElementById('qbResultContainer').classList.remove('hidden');
                document.getElementById('qbResultContainer').classList.add('fade-in');
            } catch (e) {
                console.error("Quick Builder Error:", e);
            } finally {
                qbBuildBtnText.classList.remove('hidden');
                qbBuildBtnLoader.classList.add('hidden');
                qbBuildBtn.disabled = false;
            }
        });

        // --- Strategy Lab Logic ---
        const personaOptions = document.getElementById('slPersonaOptions');
        personaOptions.addEventListener('click', (e) => {
            const selectedCard = e.target.closest('.radio-card');
            if (!selectedCard) return;
            personaOptions.querySelectorAll('.radio-card').forEach(card => card.classList.remove('selected'));
            selectedCard.classList.add('selected');
        });

        const academicSourceProtocolText = `
### 4. ×¤×¨×•×˜×•×§×•×œ ×¡×™× ×•×Ÿ ××§×•×¨×•×ª ###

#### ×¨××” 1: ××§×•×¨×•×ª ××•×¡××›×™× ×œ×©×™××•×© ×™×©×™×¨
* **1.1** ×›×ª×‘×™× ×¨××©×•× ×™×™×.
* **1.2** ×¡×¤×¨×•×ª ××©× ×™×ª ×©×¢×‘×¨×” ×‘×™×§×•×¨×ª ×¢××™×ª×™×.
* **1.3** ×× ×¦×™×§×œ×•×¤×“×™×•×ª ××§×“××™×•×ª ××¨×›×–×™×•×ª (SEP, IEP, REP).
* **1.4** ×¡×“×¨×•×ª ××“×¨×™×›×™× ×•××œ×•×•×™× ××§×“××™×™×.
* **1.5** ×©×™×— ××§×“××™ ××ª×”×•×•×” (×”×¨×¦××•×ª, ×˜×™×•×˜×•×ª ×•×›×•').
    * **×”× ×—×™×™×ª ×—×•×‘×”:** ×‘×¢×ª ×©×™××•×© ×‘××§×•×¨ ××¡×¢×™×£ 1.5, ×™×© ×œ×¦×™×™×Ÿ ××ª ××•×¤×™×• ×›×“×™ ×œ×”×‘×”×™×¨ ×©×™×™×ª×›×Ÿ ×•×˜×¨× ×¢×‘×¨ ×‘×™×§×•×¨×ª ×¢××™×ª×™× ××œ××”.
#### ×¨××” 2: ××§×•×¨×•×ª ×œ×©×™××•×© ××•×ª× ×”
* **2.1 ×•×™×§×™×¤×“×™×”:** ×™×©××© ××š ×•×¨×§ ×›×›×œ×™ ×œ××™×ª×•×¨ ×•××™××•×ª ×©×œ ××§×•×¨×•×ª ××¨××” 1.
#### ×¨××” 3: ××§×•×¨×•×ª ×¤×¡×•×œ×™× ×œ×©×™××•×©
* **3.1** ×ª×•×›×Ÿ ×’×•×œ×©×™× (×¨×©×ª×•×ª ×—×‘×¨×ª×™×•×ª, ×‘×œ×•×’×™×, ×¤×•×¨×•××™×).
* **3.2** ××ª×¨×™× ×©×™×ª×•×¤×™×™× (×œ××¢×˜ ×•×™×§×™×¤×“×™×”, ×‘×›×¤×•×£ ×œ×›×œ×œ×™ ×¨××” 2).
* **3.3** ×¤×¨×¡×•××™× ×œ× ××‘×•×§×¨×™× (×¤×•×‘×œ×™×¦×™×¡×˜×™×§×”, ×ª×•×›×Ÿ ×“×•×’××˜×™, ×•×›×•').
* **3.4** ×ª×•×›×Ÿ AI ×œ× ×××•××ª.
* **3.5** ×›×œ ××§×•×¨ ××—×¨ ×©××™× ×• ×¢×•××“ ×‘×¡×˜× ×“×¨×˜×™× ×©×œ ×¨××” 1.
`;
        
        const slBuildBtn = document.getElementById('slBuildBtn');
        const slBuildBtnText = document.getElementById('slBuildBtnText');
        const slBuildBtnLoader = document.getElementById('slBuildBtnLoader');
        const slResultContainer = document.getElementById('slResultContainer');
        
        slBuildBtn.addEventListener('click', async () => {
            const task = document.getElementById('slTask').value.trim();
            if (!task) {
                alert('×™×© ×œ×”×’×“×™×¨ ××ª ××©×™××ª ×”×œ×™×‘×”.');
                return;
            }
            
            slBuildBtnText.classList.add('hidden');
            slBuildBtnLoader.classList.remove('hidden');
            slBuildBtn.disabled = true;
            
            const selectedPersona = personaOptions.querySelector('.selected').dataset.value;
            const addSkeleton = document.getElementById('slAddSkeleton').checked;
            const sourceProtocol = document.getElementById('slSourceProtocol').value;

             const metaPrompt = `
             You are an expert prompt engineer. Your task is to build an advanced prompt for a user based on their strategic choices, and also provide a brief explanation of that strategy.
             The user's choices are:
             1. Core Task: "${task}"
             2. Persona Strategy: "${selectedPersona}"
             3. Add Conceptual Skeleton: ${addSkeleton}
             4. Source Protocol: "${sourceProtocol}"
             
             Based on these choices, generate two things in Hebrew:
             1. A brief explanation of the chosen strategy (strategyText).
             2. The complete, final, professional prompt (finalPrompt).

             Return the response as a single, valid JSON object with two keys: "strategyText" and "finalPrompt".
             Example: {"strategyText": "×‘×—×¨× ×• ×‘×¤×¨×¡×•× ×ª...", "finalPrompt": "# ×”× ×—×™×•×ª..."}
             Do not include any text outside of the JSON object.
             The generated 'finalPrompt' should use the full academic source protocol text if the user selected 'academic'.
             Full academic protocol text if needed: \n${academicSourceProtocolText.replace(/"/g, '\\"')}
             `;

            try {
                const resultText = await callVercelFunction(metaPrompt, 'slErrorContainer');
                console.log("Strategy Lab Raw Response:", resultText); // ×œ×•×’ ×œ×‘×“×™×§×”
                
                let resultJson;
                try {
                    // × ×¡×” ×œ×¤×¨×¡×¨ ×›-JSON
                    resultJson = JSON.parse(resultText);
                    console.log("Parsed as JSON:", resultJson);
                } catch (parseError) {
                    console.log("Not JSON, treating as plain text");
                    // ×× ×–×” ×œ× JSON, ×ª×¦×™×’ ××ª ×”×˜×§×¡×˜ ×™×©×™×¨×•×ª
                    resultJson = {
                        strategyText: "×”××¡×˜×¨×˜×’×™×” × ×‘× ×ª×” ×‘×”×¦×œ×—×” ×¢×œ ×¤×™ ×”×‘×—×™×¨×•×ª ×©×œ×š",
                        finalPrompt: resultText
                    };
                }

                document.getElementById('slStrategy').textContent = resultJson.strategyText || "×”××¡×˜×¨×˜×’×™×” ××•×›× ×”";
                document.getElementById('slResult').textContent = resultJson.finalPrompt || resultText;
                slResultContainer.classList.remove('hidden');
                slResultContainer.classList.add('fade-in');

            } catch(e) {
                console.error("Strategy Lab Error:", e);
            } finally {
                slBuildBtnText.classList.remove('hidden');
                slBuildBtnLoader.classList.add('hidden');
                slBuildBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
