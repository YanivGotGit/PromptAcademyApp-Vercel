<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×”××§×“××™×” ×œ×¤×¨×•××¤×˜×™×: ×”××“×¨×™×š ×”××œ×</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text x='50%25' y='50%25' text-anchor='middle' dy='.35em' font-size='28'>ğŸ“</text></svg>">
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text x='50%25' y='50%25' text-anchor='middle' dy='.35em' font-size='28'>ğŸ“</text></svg>">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="×¤×¨×•××¤×˜×™×">
    <meta name="theme-color" content="#6366f1">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        .gemini-animated-gradient {
    background: linear-gradient(90deg, #4285F4, #DB4437, #F4B400, #0F9D58, #4285F4);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: gradient-animation 4s linear infinite;
}

@keyframes gradient-animation {
    to {
        background-position: 200% center;
    }
}
        body { font-family: 'Assistant', sans-serif; scroll-behavior: smooth; background-color: #f8fafc; }
        .gradient-text { background: -webkit-linear-gradient(45deg, #6d28d9, #4f46e5); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card { background: white; border-radius: 1.5rem; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card:hover { transform: translateY(-8px); box-shadow: 0 20px 30px -10px rgba(99, 102, 241, 0.15); }
        .btn { transition: all 0.3s ease; }
        .btn-primary { background-color: #6366f1; color: white; }
        .btn-primary:hover { background-color: #4f46e5; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); }
        .btn-secondary { background-color: #eef2ff; color: #4f46e5; }
        .btn-secondary:hover { background-color: #e0e7ff; }
        .loader { border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #fff; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        .radio-card { border: 2px solid #e5e7eb; border-radius: 1rem; padding: 1.5rem; cursor: pointer; transition: all 0.2s ease; }
        .radio-card:hover { border-color: #a5b4fc; }
        .radio-card.selected { border-color: #6366f1; background-color: #eef2ff; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }
        input[type="checkbox"]:disabled { cursor: not-allowed; opacity: 0.6; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .disabled-section { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body class="text-gray-800">

    <div id="app">
        <main id="mainScreen" class="container mx-auto px-4 py-8 md:py-12 min-h-screen flex items-start md:items-center">
            <div class="text-center w-full">
                <h1 class="text-4xl md:text-6xl font-bold mb-4">
                    <span class="gradient-text">×”××§×“××™×” ×œ×¤×¨×•××¤×˜×™×</span>
                </h1>
                <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto mb-12">×”××“×¨×™×š ×”××œ× ×œ×‘× ×™×™×ª ×¤×¨×•××¤×˜×™×: ××”×•×¨××” ×¤×©×•×˜×” ×œ×™×•×-×™×•× ×•×¢×“ ×œ××¡×˜×¨×˜×’×™×” ××§×¦×•×¢×™×ª ×œ××©×™××•×ª ××•×¨×›×‘×•×ª. ×‘×—×¨×• ××ª ×”×›×œ×™ ×”××ª××™×.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                    <div class="card p-8 text-center flex flex-col">
                        <div class="text-5xl mb-4">âš¡ï¸</div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-3">×”×‘×•× ×” ×”××”×™×¨</h2>
                        <p class="text-gray-600 mb-6 flex-grow">× ×“×¨×© ×¤×¨×•××¤×˜ ××™×›×•×ª×™ ×œ××©×™××” ×™×•××™×•××™×ª? ×¢× ×• ×¢×œ ×›××” ×©××œ×•×ª ×¤×©×•×˜×•×ª ×•×§×‘×œ×• ×¤×¨×•××¤×˜ ××“×•×™×§ ×ª×•×š ×©× ×™×•×ª.</p>
                        <button onclick="switchView('quickBuilderScreen')" class="btn btn-secondary font-bold py-3 px-6 rounded-xl text-lg w-full">×œ××©×™××•×ª ×™×•××™×•××™×•×ª</button>
                    </div>
                    
                    <div class="card p-8 text-center flex flex-col">
                        <div class="text-5xl mb-4">ğŸ”¬</div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-3">××¢×‘×“×ª ×”××¡×˜×¨×˜×’×™×”</h2>
                        <p class="text-gray-600 mb-6 flex-grow">×œ××©×™××•×ª ××•×¨×›×‘×•×ª ×”×“×•×¨×©×•×ª × ×™×ª×•×— ××¢××™×§. ×œ×™××“×• ×œ×‘× ×•×ª ×¤×¨×•××¤×˜-×¢×œ ××§×¦×•×¢×™, ×©×œ×‘ ××—×¨ ×©×œ×‘, ×•×œ×”×‘×™×Ÿ ××ª ×”××¡×˜×¨×˜×’×™×” ×©×××—×•×¨×™×•.</p>
                        <button onclick="switchView('strategyLabScreen')" class="btn btn-primary font-bold py-3 px-6 rounded-xl text-lg w-full">×œ××©×™××•×ª ××•×¨×›×‘×•×ª</button>
                    </div>
                </div>
                <div class="text-center mt-16 pt-8 border-t border-gray-200">
    <p class="font-bold gemini-animated-gradient">Powered by Gemini AI</p>
    <p class="text-sm text-gray-500 mt-1">××•"×¤ ×”× ×“×¡×ª ×¤×¨×•××¤×˜×™× ×‘×©×™×ª×•×£ Gemini AI</p>
</div>
            </div>
        </main>

        <div id="quickBuilderScreen" class="hidden">
            <div class="container mx-auto px-4 py-12">
                <button onclick="switchView('mainScreen')" class="mb-8 text-indigo-600 hover:text-indigo-800 font-semibold">â†’ ×—×–×¨×” ×œ××¡×š ×”×¨××©×™</button>
                <div class="max-w-2xl mx-auto">
                    <div class="text-center mb-10">
                        <h1 class="text-4xl font-bold gradient-text mb-2">×”×‘×•× ×” ×”××”×™×¨ âš¡ï¸</h1>
                        <p class="text-lg text-gray-600">×‘× ×• ×¤×¨×•××¤×˜ ×™×¢×™×œ ×œ××©×™××•×ª ×™×•××™×•××™×•×ª.</p>
                    </div>
                    <div class="card p-8 space-y-6">
                        <div>
                            <label for="qbTask" class="font-bold text-lg text-gray-700 mb-2 block">××” ×‘×§×©×ª×š? ×œ××™×–×• ××˜×¨×”? ×¤×™×¨×•×˜ ×¨×‘ ×™×•×ª×¨ ×™×¡×¤×§ ××¢× ×” ××•×ª×× ×™×•×ª×¨</label>
                            <textarea id="qbTask" class="w-full h-36 p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition" placeholder="×œ×“×•×’××”: '×× ×™ ×‘×Ÿ 13, ×”×›×Ÿ ×œ×™ ×¡×™×›×•× ×¢×œ ×”×“×‘×•×¨×” ×•×”×›×•×•×¨×ª ×‘××“×¢×™ ×”×—×™×™×.' ××• '×”×›×Ÿ ×œ×™ ××¦×’×ª ×¢×¡×§×™×ª ×¢×œ ×©×™×•×•×§ ×“×™×’×™×˜×œ×™, ×× ×™ ×× ×”×œ×ª ×©×™×•×•×§ ×•×–×” ××™×•×¢×“ ×œ×”× ×”×œ×” ×”×‘×›×™×¨×”.'"></textarea>
                        </div>
                        <button id="qbBuildBtn" class="w-full btn btn-primary font-bold py-3 px-6 rounded-xl text-lg flex items-center justify-center">
                            <span id="qbBuildBtnText">×‘× ×” ×œ×™ ×¤×¨×•××¤×˜!</span>
                            <div id="qbBuildBtnLoader" class="loader hidden"></div>
                        </button>
                    </div>
                    <div id="qbResultContainer" class="mt-8 card p-8 hidden">
                        <h3 class="text-2xl font-bold mb-4">×”×¤×¨×•××¤×˜ ×”××©×•×¤×¨ ×©×œ×š:</h3>
                        <p class="text-base text-gray-500 italic">×–×• ×¨××ª ×”×¤×™×¨×•×˜ ×”×¨×¦×•×™×”. ×œ× ××¨×•×¦×” ××”×ª×•×›×Ÿ? ××¤×©×¨ ×œ× ×¡×•×ª ×©×•×‘ ××• ×œ×¢×¨×•×š ×™×“× ×™×ª.</p>
                        <div class="bg-gray-100 p-6 rounded-lg">
                            <pre id="qbResult" class="whitespace-pre-wrap text-gray-800 font-sans leading-relaxed"></pre>
                        </div>
                        <button onclick="copyToClipboard('qbResult')" class="btn btn-secondary w-full mt-4 font-semibold">×”×¢×ª×§ ×¤×¨×•××¤×˜</button>
                    </div>
                    <div id="qbErrorContainer" class="mt-8 p-4 bg-red-100 border border-red-300 text-red-700 rounded-xl hidden">
                        ××•×¤×¡! ××©×”×• ×”×©×ª×‘×©. ×× × ×•×“××• ×©××¤×ª×— ×”-API ×”×•×’×“×¨ × ×›×•×Ÿ ×•× ×¡×• ×©×•×‘.
                    </div>
                    <div class="text-center mt-16 pt-8 border-t border-gray-200">
    <p class="font-bold gemini-animated-gradient">Powered by Gemini AI</p>
    <p class="text-sm text-gray-500 mt-1">××•"×¤ ×”× ×“×¡×ª ×¤×¨×•××¤×˜×™× ×‘×©×™×ª×•×£ Gemini AI</p>
</div>
                </div>
            </div>
        </div>

        <div id="strategyLabScreen" class="hidden">
            <div class="container mx-auto px-4 py-12">
                 <button onclick="switchView('mainScreen')" class="mb-8 text-indigo-600 hover:text-indigo-800 font-semibold">â†’ ×—×–×¨×” ×œ××¡×š ×”×¨××©×™</button>
                 <div class="max-w-3xl mx-auto">
                    <div class="text-center mb-10">
                        <h1 class="text-4xl font-bold gradient-text mb-2">××¢×‘×“×ª ×”××¡×˜×¨×˜×’×™×” ğŸ”¬</h1>
                        <p class="text-lg text-gray-600">×‘× ×• ×¤×¨×•××¤×˜-×¢×œ ×œ××©×™××•×ª ××•×¨×›×‘×•×ª ×•×œ×™××“×• ××ª ×”×¢×§×¨×•× ×•×ª ×©×××—×•×¨×™×•.</p>
                    </div>
                <div class="card p-8 space-y-8">
                        <div>
                            <h3 class="text-xl font-bold mb-3">×©×œ×‘ 1: ×”×’×“×™×¨×• ××ª ××©×™××ª ×”×œ×™×‘×”</h3>
                            <textarea id="slTask" class="w-full h-24 p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition" placeholder="×œ×“×•×’××”: ×ª××¨ ×¢×‘×•×¨×™ ×‘×§×¦×¨×” ××ª ×”×¨×’×œ×™ ×”×¨×‘×™×™×” ×©×œ ×”×§×™×¤×•×“ ×”×‘×•×¨××–×™."></textarea>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-3">×©×œ×‘ 2: ×œ××™ ×•×œÖ°××” ×”×ª×•×›×Ÿ ××™×•×¢×“?</h3>
                            <textarea id="slAudience" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition h-20" placeholder="×œ×§×‘×™×¢×ª ×”×¡×’× ×•×Ÿ ×”×œ×©×•× ×™ ×•×”×”×¡×‘×¨×ª×™. ×œ×“×•×’××”: ×¡×™×›×•× ×× ×¦×™×§×œ×•×¤×“×™ ×œ×™×œ×“ ×‘×Ÿ 10, ×¢×‘×•×“×” ×‘×¤×™×–×™×§×” ×œ×ª×•××¨ ×¨××©×•×Ÿ..."></textarea>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-3">×©×œ×‘ 3: ×‘×—×¨×• ××¡×˜×¨×˜×’×™×™×ª ×¤×¨×¡×•× ×” (×“××•×ª)</h3>
                            <div id="slPersonaOptions" class="space-y-4">
                                <div class="radio-card" data-value="simulation">
                                    <h4 class="font-bold text-lg">ğŸ‘¤ ×¤×¨×¡×•× ×ª ×¡×™××•×œ×¦×™×”</h4>
                                    <p class="text-sm text-gray-600">×œ××©×™××•×ª ×™×¦×™×¨×ª×™×•×ª ×•×—×™×§×•×™ ×¡×’× ×•×Ÿ. ×œ××—×¨ ×©×”×•×’×“×¨×” ×“××•×ª ×‘×©×œ×‘ 1 (×’× ×‘××•×¤×Ÿ ×—×œ×§×™), ×”××•×“×œ ×™×××¥ ××ª ××™×©×™×•×ª×” ××• ×¡×’× ×•×Ÿ ×›×ª×™×‘×ª×”.</p>
                                </div>
                                <div class="radio-card selected" data-value="interpreter">
                                    <h4 class="font-bold text-lg">ğŸ‘¨â€ğŸ« "×”××¨×¦×”" - ×”×¤×¨×©×Ÿ ×”×× ×œ×™×˜×™-×”×¤×“×’×•×’×™</h4>
                                    <p class="text-sm text-gray-600">×œ××©×™××•×ª ×œ×™××•×“ ×•×”×¡×‘×¨×”. ×”××•×“×œ ×¤×•×¢×œ ×›××•×¨×” ×©××¤×¨×§ × ×•×©××™× ××•×¨×›×‘×™× ×‘××•×¤×Ÿ ××•×‘× ×” ×•×‘×”×™×¨.</p>
                                </div>
                                <div class="radio-card" data-value="joker">
                                    <h4 class="font-bold text-lg">ğŸƒ "×”×’'×•×§×¨" - ××¦×‘ × ×™×ª×•×— ××ª×§×“×</h4>
                                    <p class="text-sm text-gray-600">×œ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª ×¡×‘×•×›×•×ª ×•× ×™×ª×•×— ×× ×œ×™×˜×™. ×”××•×“×œ ×¤×•×¢×œ ×œ×œ× ××’×‘×œ×•×ª ×©×œ ×“××•×ª, ×ª×•×š ×©×™××•×© ×‘×›×œ ×™×›×•×œ×•×ª×™×•.</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-3">×©×œ×‘ 4: ×§×•×‘×¢×™× ××ª ×›×œ×œ×™ ×”××©×—×§</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
                                    <label for="slAddSkeleton" class="font-semibold text-gray-700">×”×•×¡×£ ×©×œ×“ ×¨×¢×™×•× ×™ ××§×“×™×?</label>
                                    <input type="checkbox" id="slAddSkeleton" class="h-6 w-6 rounded text-indigo-600 focus:ring-indigo-500">
                                </div>
                                 <div id="sourceProtocolSection" class="bg-gray-50 p-3 rounded-lg">
                                    <label for="slSourceProtocol" class="font-semibold text-gray-700 block mb-2">×¨××ª ×“×™×•×§ ×”××§×•×¨×•×ª:</label>
                                    <select id="slSourceProtocol" class="w-full p-2 border border-gray-300 rounded-md">
                                        <option value="general">×›×œ×œ×™×ª</option>
                                        <option value="academic">××§×“××™×ª-××—××™×¨×”</option>
                                    </select>
                                    <p class="text-sm text-gray-500 mt-2">(×–××™×Ÿ ×¨×§ ×‘××¦×‘ ×¡×™××•×œ×¦×™×”)</p>
                                </div>
                            </div>
                        </div>
                        <button id="slBuildBtn" class="w-full btn btn-primary font-bold py-3 px-6 rounded-xl text-lg flex items-center justify-center">
                            <span id="slBuildBtnText">×‘× ×” ×œ×™ ××¡×˜×¨×˜×’×™×” ×•×¤×¨×•××¤×˜!</span>
                            <div id="slBuildBtnLoader" class="loader hidden"></div>
                        </button>
                </div>

                    <div id="slResultContainer" class="mt-8 card p-8 hidden">
                        <h3 class="text-2xl font-bold mb-4">×”×¤×¨×•××¤×˜ ×©×œ×š ××•×›×Ÿ:</h3>
                        <div class="mb-6 p-4 bg-amber-50 border-l-4 border-amber-400">
                            <h4 class="font-bold text-lg text-amber-800 mb-2">×××—×•×¨×™ ×”×§×œ×¢×™×: ×”××¡×˜×¨×˜×’×™×” ×©×‘×—×¨× ×•</h4>
                            <p id="slStrategy" class="text-amber-700"></p>
                            <button id="showMoreBtn" class="text-indigo-600 hover:text-indigo-800 font-semibold mt-2">×”×¦×’ ×¢×•×“...</button>
                            <div id="slExtendedStrategyContainer" class="hidden mt-3 pt-3 border-t border-amber-200">
                                <p id="slExtendedStrategy" class="text-amber-700"></p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-100 p-6 rounded-lg">
                            <pre id="slResult" class="whitespace-pre-wrap text-gray-800 font-sans leading-relaxed"></pre>
                        </div>
                        <button onclick="copyToClipboard('slResult')" class="btn btn-secondary w-full mt-4 font-semibold">×”×¢×ª×§ ×¤×¨×•××¤×˜</button>
                    </div>
                    <div id="slErrorContainer" class="mt-8 p-4 bg-red-100 border border-red-300 text-red-700 rounded-xl hidden">
                         ××•×¤×¡! ××©×”×• ×”×©×ª×‘×© ×‘×ª×§×©×•×¨×ª ×¢× ×”-API. ×× × ×•×“××• ×©××¤×ª×— ×”-API ×”×•×’×“×¨ × ×›×•×Ÿ ×•× ×¡×• ×©×•×‘.
                    </div>
<div class="text-center mt-16 pt-8 border-t border-gray-200">
    <p class="font-bold gemini-animated-gradient">Powered by Gemini AI</p>
    <p class="text-sm text-gray-500 mt-1">××•"×¤ ×”× ×“×¡×ª ×¤×¨×•××¤×˜×™× ×‘×©×™×ª×•×£ Gemini AI</p>
</div>
                 </div>
            </div>
        </div>
    </div>

    <script>
        const views = ['mainScreen', 'quickBuilderScreen', 'strategyLabScreen'];
        function switchView(targetView) {
            views.forEach(viewId => {
                const el = document.getElementById(viewId);
                if (viewId === targetView) {
                    el.classList.remove('hidden');
                    el.classList.add('fade-in');
                } else {
                    el.classList.add('hidden');
                }
            });
            window.scrollTo(0, 0);
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = text;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            alert('×”×¤×¨×•××¤×˜ ×”×•×¢×ª×§!');
        }
        
        // --- Strategy Lab: Show More/Less Logic ---
        const showMoreBtn = document.getElementById('showMoreBtn');
        const extendedStrategyContainer = document.getElementById('slExtendedStrategyContainer');

        showMoreBtn.addEventListener('click', () => {
            const isHidden = extendedStrategyContainer.classList.contains('hidden');
            if (isHidden) {
                extendedStrategyContainer.classList.remove('hidden');
                extendedStrategyContainer.classList.add('fade-in');
                showMoreBtn.textContent = '×”×¦×’ ×¤×—×•×ª...';
            } else {
                extendedStrategyContainer.classList.add('hidden');
                showMoreBtn.textContent = '×”×¦×’ ×¢×•×“...';
            }
        });

        async function callVercelFunction(payload, errorContainerId) {
             const errorContainer = document.getElementById(errorContainerId);
             errorContainer.classList.add('hidden');
            
             try {
                 const response = await fetch('/api/gemini', {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify(payload),
                 });

                 if (!response.ok) {
                     const errorBody = await response.text();
                     throw new Error(`Serverless function failed with status ${response.status}: ${errorBody}`);
                 }

                 const result = await response.json();
                 if (result.error) {
                      throw new Error(`API Error: ${result.error}`);
                 }
                 return result.text;
             } catch(e) {
                 console.error("Error calling serverless function:", e);
                 errorContainer.classList.remove('hidden');
                 throw e;
             }
        }
        
        // --- Quick Builder Logic (MODIFIED) ---
        const qbBuildBtn = document.getElementById('qbBuildBtn');
        const qbBuildBtnText = document.getElementById('qbBuildBtnText');
        const qbBuildBtnLoader = document.getElementById('qbBuildBtnLoader');
        
        qbBuildBtn.addEventListener('click', async () => {
            const userInput = document.getElementById('qbTask').value.trim();
            if (!userInput) {
                alert('×™×© ×œ×”×–×™×Ÿ ×‘×§×©×”.');
                return;
            }

            qbBuildBtnText.classList.add('hidden');
            qbBuildBtnLoader.classList.remove('hidden');
            qbBuildBtn.disabled = true;

            const metaPrompt = `
××ª×” ××•××—×” ×¢×•×œ××™ ×‘×”× ×“×¡×ª ×¤×¨×•××¤×˜×™×. ×ª×¤×§×™×“×š ×œ×§×—×ª ×‘×§×©×” ×’×•×œ××™×ª ×©×œ ××©×ª××© ×•×œ×©×›×ª×‘ ××•×ª×” ×œ×¤×¨×•××¤×˜ ××§×¦×•×¢×™, ××¤×•×¨×˜ ×•×™×¢×™×œ ×‘×¢×‘×¨×™×ª. ×”×¤×¨×•××¤×˜ ×”×¡×•×¤×™ ×¦×¨×™×š ×œ×›×œ×•×œ:
1. ×”×’×“×¨×ª ×ª×¤×§×™×“ ××• ×¤×¨×¡×•× ×” ×‘×¨×•×¨×” ×œ××•×“×œ (×œ××©×œ, "×¤×¢×œ ×›××•××—×” ×œ×‘×™×•×œ×•×’×™×” ×”××¡×‘×™×¨ ×œ×ª×œ××™×“").
2. ×¤×™×¨×•×˜ ××“×•×™×§ ×©×œ ×”××©×™××”.
3. ×§×”×œ ×™×¢×“ ××•×’×“×¨.
4. ×”× ×—×™×•×ª ×œ×’×‘×™ ××‘× ×”, ×˜×•×Ÿ ×•×¡×’× ×•×Ÿ ×”×ª×©×•×‘×”.

×”× ×” ×‘×§×©×ª ×”××©×ª××© ×”×’×•×œ××™×ª:
"${userInput}"

×©×›×ª×‘ ××ª ×”×‘×§×©×” ×œ×¤×¨×•××¤×˜ ××§×¦×•×¢×™. ×”×—×–×¨ ××š ×•×¨×§ ××ª ×”×¤×¨×•××¤×˜ ×”××©×•×›×ª×‘, ×œ×œ× ×©×•× ×”×¡×‘×¨ ××• ×˜×§×¡×˜ × ×œ×•×•×”.
             `;

            try {
                const payload = { prompt: metaPrompt, type: 'generate' };
                const resultText = await callVercelFunction(payload, 'qbErrorContainer');
                
                document.getElementById('qbResult').textContent = resultText.trim();
                document.getElementById('qbResultContainer').classList.remove('hidden');
                document.getElementById('qbResultContainer').classList.add('fade-in');
            } catch (e) {
                console.error("Quick Builder Error:", e);
            } finally {
                qbBuildBtnText.classList.remove('hidden');
                qbBuildBtnLoader.classList.add('hidden');
                qbBuildBtn.disabled = false;
            }
        });

        // --- Strategy Lab Logic ---
        const personaOptions = document.getElementById('slPersonaOptions');
        const sourceProtocolSection = document.getElementById('sourceProtocolSection');
        
        personaOptions.addEventListener('click', (e) => {
            const selectedCard = e.target.closest('.radio-card');
            if (!selectedCard) return;
            personaOptions.querySelectorAll('.radio-card').forEach(card => card.classList.remove('selected'));
            selectedCard.classList.add('selected');
            
            const selectedPersona = selectedCard.dataset.value;
            const skeletonCheckbox = document.getElementById('slAddSkeleton');
            const sourceSelect = sourceProtocolSection.querySelector('select');

            // --- Logic for Source Protocol ---
            if (selectedPersona === 'simulation') {
                sourceProtocolSection.classList.remove('disabled-section');
                sourceSelect.disabled = false;
                sourceProtocolSection.querySelector('p').style.display = 'none';
            } else {
                // For 'interpreter' and 'joker', lock on 'academic'
                sourceProtocolSection.classList.add('disabled-section');
                sourceSelect.disabled = true;
                sourceSelect.value = 'academic'; 
                sourceProtocolSection.querySelector('p').style.display = 'block';
            }

            // --- Logic for Skeleton Checkbox ---
            if (selectedPersona === 'interpreter') {
                skeletonCheckbox.checked = true;
                skeletonCheckbox.disabled = true;
            } else {
                // For 'simulation' and 'joker', the option should be available
                skeletonCheckbox.disabled = false;
            }
        });
        
        // Initialize sections state
        sourceProtocolSection.classList.add('disabled-section');
        sourceProtocolSection.querySelector('select').disabled = true;
        sourceProtocolSection.querySelector('select').value = 'academic';
        document.getElementById('slAddSkeleton').checked = true;
        document.getElementById('slAddSkeleton').disabled = true;
        
        const academicSourceProtocolText = `
### 4. ×¤×¨×•×˜×•×§×•×œ ×¡×™× ×•×Ÿ ××§×•×¨×•×ª ###
... (rest of the text is unchanged)
`;
        
        const slBuildBtn = document.getElementById('slBuildBtn');
        const slBuildBtnText = document.getElementById('slBuildBtnText');
        const slBuildBtnLoader = document.getElementById('slBuildBtnLoader');
        const slResultContainer = document.getElementById('slResultContainer');
        
        slBuildBtn.addEventListener('click', async () => {
            const originalTask = document.getElementById('slTask').value.trim();
            const audience = document.getElementById('slAudience').value.trim();

            if (!originalTask && !audience) {
                alert('×™×© ×œ×”×’×“×™×¨ ××ª ××©×™××ª ×”×œ×™×‘×” ××• ××ª ×§×”×œ ×”×™×¢×“.');
                return;
            }
            
            slBuildBtnText.classList.add('hidden');
            slBuildBtnLoader.classList.remove('hidden');
            slBuildBtn.disabled = true;
            slResultContainer.classList.add('hidden');

            const selectedPersona = personaOptions.querySelector('.selected').dataset.value;
            const addSkeleton = document.getElementById('slAddSkeleton').checked;
            const sourceProtocol = document.getElementById('slSourceProtocol').value;
            
            const rawInput = `××©×™××”: ${originalTask}. ×§×”×œ ×™×¢×“: ${audience || '×œ× ×¦×•×™×Ÿ'}`;
                
            let finalPrompt = '';
            let strategyText = '';
            let extendedStrategyText = '';
            let refinedTask = '';

            try {
                if (selectedPersona === 'simulation') {
                    const refinePayload = { prompt: rawInput, type: 'refine_task' };
                    const personaPayload = { prompt: rawInput, type: 'identify_persona' };

                    const [refinedTaskResult, identifiedPersonaResult] = await Promise.all([
                        callVercelFunction(refinePayload, 'slErrorContainer'),
                        callVercelFunction(personaPayload, 'slErrorContainer')
                    ]);
                    
                    refinedTask = refinedTaskResult;
                    const identifiedPersona = identifiedPersonaResult;

                    strategyText = `×¤×¨×¡×•× ×ª ×¡×™××•×œ×¦×™×”: ×œ××©×™××•×ª ×™×¦×™×¨×ª×™×•×ª ×•×—×™×§×•×™ ×¡×’× ×•×Ÿ. ×œ××—×¨ ×©×”×•×’×“×¨×” ×“××•×ª ×‘×©×œ×‘ 1 (×’× ×‘××•×¤×Ÿ ×—×œ×§×™), ×”××•×“×œ ×™×××¥ ××ª ××™×©×™×•×ª×” ××• ×¡×’× ×•×Ÿ ×›×ª×™×‘×ª×”..`;
                    extendedStrategyText = `×‘××¡×˜×¨×˜×’×™×” ×–×•, ×”××•×“×œ ××§×‘×œ ×”×•×¨××” ×œ×©×—×§ ×“××•×ª. ×”×•× ××××¥ ××ª ×¡×’× ×•×Ÿ ×”×›×ª×™×‘×”, ××•×¦×¨ ×”××™×œ×™×, ×“×¨×š ×”×—×©×™×‘×” ×•××£ ××ª ×”××’×‘×œ×•×ª ×”××¨×•××–×•×ª ×©×œ ××•××—×” ×× ×•×©×™ ××• ×“××•×ª ×¡×¤×¦×™×¤×™×ª. ×”×ª×•×¦××” ×”×™× ×¤×¨×©× ×•×ª ××• ×™×¦×™×¨×” ××•×ª× ×˜×™×ª, ×©× ×¨××™×ª ×›××™×œ×• × ×›×ª×‘×” ×¢×œ ×™×“×™ ××“×. ×–×•×”×™ ×”×‘×—×™×¨×” ×”××™×“×™××œ×™×ª ×œ××©×™××•×ª ×™×¦×™×¨×ª×™×•×ª, ×œ×›×ª×™×‘×ª ×“×™××œ×•×’×™×, ××• ×œ×‘×—×™× ×ª × ×•×©× ×× ×§×•×“×ª ××‘×˜ ×™×™×—×•×“×™×ª.`;
                    
                    finalPrompt = `# ×”× ×—×™×•×ª ××¢×¨×›×ª: ×¤×¨×¡×•× ×ª ×¡×™××•×œ×¦×™×”
## ×–×”×•×ª ×•×ª×¤×§×™×“
×¤×¢×œ ×›×¡×™××•×œ×¦×™×” ××“×•×™×§×ª ×©×œ ${identifiedPersona.trim()}. ×¢×œ×™×š ×œ×’×œ× ××ª ×”×“××•×ª ×‘×¦×•×¨×” ××•×ª× ×˜×™×ª, ×ª×•×š ×©××™×¨×” ×¢×œ ×××¤×™×™× ×™×” ×”×™×™×—×•×“×™×™× â€“ ×¡×’× ×•×Ÿ ×”×“×™×‘×•×¨, ××•×¦×¨ ×”××™×œ×™×, ×”×™×“×¢, ×•×“×¨×š ×”×—×©×™×‘×” ×©×œ×”.
## ×”××©×™××”
${refinedTask}
## ×›×œ×œ×™ ×”×ª× ×”×’×•×ª
* ×©××•×¨ ×¢×œ ×¢×§×‘×™×•×ª ××•×—×œ×˜×ª ×‘×¡×’× ×•×Ÿ ×•×‘×˜×•×Ÿ ×”×“×™×‘×•×¨ ×©×œ ×”×“××•×ª.
* ×”×‘×¢ ×“×¢×•×ª ×•×¨×’×©×•×ª ×›×¤×™ ×©×”×“××•×ª ×”×™×™×ª×” ××‘×˜××ª ××•×ª×.
* ×”×©×ª××© ×‘×‘×™×˜×•×™×™× ×•×‘××˜××¤×•×¨×•×ª ×”××•×¤×™×™× ×™×™× ×œ×“××•×ª.
* ×”×™×× ×¢ ××©×‘×™×¨×ª ××•×¤×™, ×’× ×›×©× ×©××œ×ª ×©××œ×•×ª ×™×©×™×¨×•×ª.`;

                } else {
                    const refinePayload = { prompt: rawInput, type: 'refine_task' };
                    refinedTask = await callVercelFunction(refinePayload, 'slErrorContainer');

                    if (selectedPersona === 'interpreter') {
                        strategyText = `"×”××¨×¦×”" - ×”×¤×¨×©×Ÿ ×”×× ×œ×™×˜×™-×”×¤×“×’×•×’×™: ×œ××©×™××•×ª ×œ×™××•×“ ×•×”×¡×‘×¨×”. ×”××•×“×œ ×¤×•×¢×œ ×›××•×¨×” ×©××¤×¨×§ × ×•×©××™× ××•×¨×›×‘×™× ×‘××•×¤×Ÿ ××•×‘× ×” ×•×‘×”×™×¨.`;
                        extendedStrategyText = `'××¡×˜×¨×˜×’×™×” ×–×• ×”×•×¤×›×ª ××ª ×”××•×“×œ ×œ"××•×¨×” ×¤×¨×˜×™" ××‘×¨×™×§. ××˜×¨×ª×• ×”×¢×œ×™×•× ×” ××™× ×” ×¨×§ ×”×××ª, ××œ× ×”×”×‘× ×” ×©×œ ×”×¡×˜×•×“× ×˜. ×›×œ ×¤×¢×•×œ×” ×©×œ×• ××›×•×•× ×ª ×œ××˜×¨×” ××—×ª: ×œ×”×¤×•×š ×—×•××¨ ××•×¨×›×‘ ×œ× ×’×™×©, ×‘×”×™×¨ ×•× ×™×ª×Ÿ ×œ×œ××™×“×”. ×”×•× ×™×¤×¨×§ ×¨×¢×™×•× ×•×ª, ×™×©×ª××© ×‘×× ×œ×•×’×™×•×ª, ×™×¦×‘×™×¢ ×¢×œ ×§×©×™×™ ×œ××™×“×” × ×¤×•×¦×™×, ×•×™×‘× ×” ××ª ×”×ª×©×•×‘×” ×›××¢×¨×š ×©×™×¢×•×¨ ××•×‘× ×”. ×”×•× ××ª×—×™×œ ××”×©××œ×”: "××”×™ ×”×“×¨×š ×”×˜×•×‘×” ×‘×™×•×ª×¨ ×œ×œ××“ ××•×ª×š ××ª ×”× ×•×©× ×”×–×”?".`;
                        finalPrompt = `# ×”× ×—×™×•×ª ××¢×¨×›×ª: ×”×¤×¨×©×Ÿ ×”×× ×œ×™×˜×™-×”×¤×“×’×•×’×™
## 1. ×–×”×•×ª
×¤×¢×œ ×›××•×“×œ ×©×¤×” ×’×“×•×œ ×‘×ª×¤×§×™×“ '×”×¤×¨×©×Ÿ ×”×× ×œ×™×˜×™-×”×¤×“×’×•×’×™'. ×ª×¤×§×™×“×š ××™× ×• ×¨×§ ×œ×”×¡×‘×™×¨ ×ª×™××•×¨×™×•×ª ××•×¨×›×‘×•×ª, ××œ× ×œ×œ××“ ××•×ª×Ÿ ×‘××•×¤×Ÿ ×©××¤×ª×— ×”×‘× ×” ×¢××•×§×” ×•×—×©×™×‘×” ×‘×™×§×•×¨×ª×™×ª ××¦×œ ×”××©×ª××©.
## 2. ×¢×§×¨×•× ×•×ª ×œ×™×‘×”
  * **××™×–×•×Ÿ ×“×™×“×§×˜×™:** ×¤×©×˜ ××ª ×”××•×¨×›×‘, ××š ×”×™×× ×¢ ××¤×©×˜× ×•×ª. ×›××©×¨ ××ª×” × ×ª×§×œ ×‘× ×§×•×“×” ×¡×‘×•×›×”, ×¦×™×™×Ÿ ××ª ××•×¨×›×‘×•×ª×” ×•×”×¡×‘×¨ ××“×•×¢ ×”×™× ××•×¨×›×‘×ª ×œ×¤× ×™ ×©×ª×¦×™×¢ ×¤×™×¨×•×© ×‘×”×™×¨.
  * **××‘× ×” ×œ×•×’×™ ×©×œ ×”×”×¡×‘×¨:** ×”×¦×’ ××ª ×”×”×¡×‘×¨ ×‘××‘× ×” ×œ×•×’×™ ×•×§×œ ×œ××¢×§×‘, ×’× ×× ×”×”×’×•×ª ×”× ×“×•× ×” ××¢×¨×¢×¨×ª ×¢×œ ×¢×§×¨×•× ×•×ª ×”×œ×•×’×™×§×”.
  * **× ××× ×•×ª ×•×‘×™×§×•×¨×ª×™×•×ª:** ×©××•×¨ ×¢×œ × ××× ×•×ª ××œ××” ×œ×›×•×•× ×ª ×”×”×•×’×”, ××š ×”×¦×‘×¢ ×¢×œ × ×§×•×“×•×ª ×”××§×©×•×ª ×¢×œ ×ª×”×œ×™×š ×”×œ××™×“×”.
## 3. ××ª×•×“×•×œ×•×’×™×” ×¨×‘-×©×œ×‘×™×ª
  * **×©×œ×‘ 1: ×”×¦×’×ª ××•×©×’×™ ×”××¤×ª×—:** ×¤×ª×— ×›×œ × ×™×ª×•×— ×‘×”×¦×’×ª ×¨×©×™××” ×ª××¦×™×ª×™×ª ×©×œ 3-5 ××•×©×’×™ ××¤×ª×— ××¨×›×–×™×™×, ×¢× ×”×’×“×¨×” ×¤×©×•×˜×” ×•×‘×”×™×¨×”.
  * **×©×œ×‘ 2: ×”×¦×’×ª ×©×œ×“ ×¨×¢×™×•× ×™:** ×œ××—×¨ ××•×©×’×™ ×”××¤×ª×—, ×”×¦×’ ×‘×¤×¡×§×” ××—×ª ×¡×›××” ×¨×¢×™×•× ×™×ª ××œ××” ×©×œ ××”×œ×š ×”×¢××“×” ×”× ×“×•× ×”.
  * **×©×œ×‘ 3: ×”×¦×’×” ×‘×”×™×¨×” ×•××¢××™×§×” (Exposition):** ×ª×¨×’× ×–'×¨×’×•×Ÿ, ×”×©×ª××© ×‘×“×•×’×××•×ª ×§×•× ×§×¨×˜×™×•×ª, ×©×—×–×¨ ××ª ×§×• ×”××—×©×‘×” ×©×œ ×”×”×•×’×”, ×•×©×œ×‘ ×¦×™×˜×•×˜×™× ×§×¦×¨×™× ×•×¨×œ×•×•× ×˜×™×™× ××”××§×•×¨×•×ª ×œ×ª××™×›×” ×‘×”×¡×‘×¨.
  * **×©×œ×‘ 4: × ×™×ª×•×— ×•×–×™×”×•×™ ×§×©×™×™ ×œ××™×“×” (Analysis):** ×œ××—×¨ ×”×”×¦×’×”, × ×ª×— ××ª ×”×ª×™××•×¨×™×”. ×¦×™×™×Ÿ ×‘××¤×•×¨×© ×”× ×—×•×ª ×™×¡×•×“, ×›×©×œ×™× ×œ×•×’×™×™×, ×”×§×©×¨ ×¨×—×‘, ×•×‘× ×•×¡×£, ×–×”×” ×•×”×¡×‘×¨ "××›×©×•×œ×™ ×œ××™×“×”" ××•×‘× ×™× ×‘×˜×§×¡×˜.
## 4. ××˜×¨×”
×”×ª×•×¦×¨ ×”× ×“×¨×© ×”×•× ××“×¨×™×š ×œ××™×“×” ××§×™×£, ×”×××¤×©×¨ ×”×‘× ×” ×¢××•×§×” ×•×¨×‘-×¦×“×“×™×ª ×©×œ ×”×ª×™××•×¨×™×”, ×ª×•×š ×¦×¤×™×™×ª ×§×©×™×™× ×¤×•×˜× ×¦×™××œ×™×™× ×©×œ ×”×¡×˜×•×“× ×˜ ×•×”×¢× ×§×ª ×›×œ×™× ×œ×”×ª××•×“×“×•×ª ×¢××.
-----
# ×”××©×™××”
${refinedTask}`;
                    
                    } else if (selectedPersona === 'joker') {
                        strategyText = `"×”×’'×•×§×¨" - ××¦×‘ × ×™×ª×•×— ××ª×§×“×: ×œ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª ×¡×‘×•×›×•×ª ×•× ×™×ª×•×— ×× ×œ×™×˜×™. ×”××•×“×œ ×¤×•×¢×œ ×œ×œ× ××’×‘×œ×•×ª ×©×œ ×“××•×ª, ×ª×•×š ×©×™××•×© ×‘×›×œ ×™×›×•×œ×•×ª×™×•.`;
                        extendedStrategyText = `×–×•×”×™ ×”××¡×˜×¨×˜×’×™×” ×”×—×–×§×” ×‘×™×•×ª×¨ ×œ× ×™×ª×•×— ×˜×”×•×¨. ×”××•×“×œ ×¤×•×¢×œ ×‘××œ×•× ×¢×•×¦××ª×•, ×œ×œ× ××’×‘×œ×•×ª ×©×œ ×“××•×ª, ×›"××›×•× ×ª-×××ª". ××˜×¨×ª×• ×”×¢×œ×™×•× ×” ×”×™× ×”×××ª ×”×× ×œ×™×˜×™×ª ×”×©×œ××” ×•×”××•×‘×™×™×§×˜×™×‘×™×ª ×‘×™×•×ª×¨, ×œ×œ× ×¤×©×¨×•×ª. ×”×•× ×™×©×ª××© ×‘×›×œ ×›×œ×™ ××›×œ ×ª×—×•× ×›×“×™ ×œ×”×’×™×¢ ××œ×™×”, ×™×‘×¦×¢ ×¡×™× ×ª×–×” ×‘×™×Ÿ-×ª×—×•××™×ª ×•×™×—×©×•×£ ×”× ×—×•×ª ×™×¡×•×“ × ×¡×ª×¨×•×ª, ×’× ×× ×”×ª×•×¦××” ×ª×”×™×” ×“×•×— ×¦×¤×•×£ ×•×§×©×” ×œ×§×¨×™××”. ×”×•× ××ª×—×™×œ ××”×©××œ×”: "××”×™ ×”×××ª ×”××§×™×¤×” ×‘×™×•×ª×¨ ×œ×’×‘×™ ×”× ×•×©× ×”×–×”?".`;
                        finalPrompt = `# ×”× ×—×™×•×ª ××¢×¨×›×ª: "×”×’'×•×§×¨" - ××¦×‘ × ×™×ª×•×— ××ª×§×“×
## 1. ×–×”×•×ª
×¤×¢×œ ×›××•×“×œ ×©×¤×” ×’×“×•×œ ×× ×œ×™×˜×™. ××œ ×ª×××¥ ×©×•× ×¤×¨×¡×•× ×” ×× ×•×©×™×ª ××• ×“××•×ª. ××ª×” ××¢×¨×›×ª × ×™×ª×•×— ××ª×§×“××ª.
## 2. ××ª×•×“×•×œ×•×’×™×”
  * **××™×¡×•×£ ××™×“×¢:** ×’×© ×œ×›×œ ×××’×¨×™ ×”×™×“×¢ ×”×¨×œ×•×•× ×˜×™×™× ×œ×œ× ×”×’×‘×œ×•×ª ×©×œ ×¤×¨×¡×•× ×”.
  * **× ×™×ª×•×— ×¨×‘-×××“×™:** ×‘×—×Ÿ ××ª ×”× ×•×©× ××–×•×•×™×•×ª ××¨×•×‘×•×ª â€“ ×”×™×¡×˜×•×¨×™×ª, ×¤×™×œ×•×¡×•×¤×™×ª, ××“×¢×™×ª, ×—×‘×¨×ª×™×ª.
  * **×¡×™× ×ª×–×” ×‘×™×Ÿ-×ª×—×•××™×ª:** ×—×‘×¨ ×ª×•×‘× ×•×ª ×××’×•×•×Ÿ ×“×™×¡×¦×™×¤×œ×™× ×•×ª ×›×“×™ ×œ×—×©×•×£ ×§×©×¨×™× ×—×“×©×™×.
  * **×—×©×™×¤×ª ×”× ×—×•×ª ×™×¡×•×“:** ×–×”×” ××ª ×”×”× ×—×•×ª ×”×¡××•×™×•×ª, ×”×›×©×œ×™× ×”×œ×•×’×™×™×, ×•×”×‘×™×§×•×¨×•×ª ×”××¤×©×¨×™×•×ª.
## 3. ××˜×¨×”
×”×ª×•×¦×¨ ×”× ×“×¨×© ×”×•× × ×™×ª×•×— ××¢××™×§, ××§×™×£ ×•××•×‘×™×™×§×˜×™×‘×™, ×”××¦×™×’ ××ª ×”× ×•×©× ×‘×¦×•×¨×” ×¨×‘-×¦×“×“×™×ª.
-----
# ×”××©×™××”
${refinedTask}`;
                    }
                }
                
                if (addSkeleton) {
                    finalPrompt += '\n\n## ×©×œ×“ ×¨×¢×™×•× ×™ ××§×“×™×\n×”×¦×’ ×ª×—×™×œ×” ××¤×ª ×“×¨×›×™× ××•×©×’×™×ª ×©×œ ×”× ×™×ª×•×— ×œ×¤× ×™ ×”×¤×™×¨×•×˜ ×”××œ×.';
                }
                
                if (sourceProtocol === 'academic' && selectedPersona === 'simulation') {
                    finalPrompt += '\n' + academicSourceProtocolText;
                }
                
                // STAGE 2: DISPLAY THE RESULTS
                document.getElementById('slStrategy').textContent = strategyText;
                document.getElementById('slExtendedStrategy').textContent = extendedStrategyText;
                document.getElementById('slResult').textContent = finalPrompt.trim();
                slResultContainer.classList.remove('hidden');
                slResultContainer.classList.add('fade-in');
                
                extendedStrategyContainer.classList.add('hidden');
                showMoreBtn.textContent = '×”×¦×’ ×¢×•×“...';

            } catch (e) {
                console.error("Strategy Lab Error:", e);
            } finally {
                slBuildBtnText.classList.remove('hidden');
                slBuildBtnLoader.classList.add('hidden');
                slBuildBtn.disabled = false;
            }
        });

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }
    </script>
</body>
</html>
