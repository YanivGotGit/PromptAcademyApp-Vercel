<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>האקדמיה לפרומפטים: המדריך המלא</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text x='50%25' y='50%25' text-anchor='middle' dy='.35em' font-size='28'>🎓</text></svg>">
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text x='50%25' y='50%25' text-anchor='middle' dy='.35em' font-size='28'>🎓</text></svg>">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="פרומפטים">
    <meta name="theme-color" content="#6366f1">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; scroll-behavior: smooth; background-color: #f8fafc; }
        .gradient-text { background: -webkit-linear-gradient(45deg, #6d28d9, #4f46e5); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card { background: white; border-radius: 1.5rem; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card:hover { transform: translateY(-8px); box-shadow: 0 20px 30px -10px rgba(99, 102, 241, 0.15); }
        .btn { transition: all 0.3s ease; }
        .btn-primary { background-color: #6366f1; color: white; }
        .btn-primary:hover { background-color: #4f46e5; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); }
        .btn-secondary { background-color: #eef2ff; color: #4f46e5; }
        .btn-secondary:hover { background-color: #e0e7ff; }
        .loader { border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #fff; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        .radio-card { border: 2px solid #e5e7eb; border-radius: 1rem; padding: 1.5rem; cursor: pointer; transition: all 0.2s ease; }
        .radio-card:hover { border-color: #a5b4fc; }
        .radio-card.selected { border-color: #6366f1; background-color: #eef2ff; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }
        input[type="checkbox"]:disabled { cursor: not-allowed; opacity: 0.6; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .disabled-section { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body class="text-gray-800">

    <div id="app">
        <main id="mainScreen" class="container mx-auto px-4 py-12 min-h-screen flex items-center">
            <div class="text-center w-full">
                <h1 class="text-4xl md:text-6xl font-bold mb-4">
                    <span class="gradient-text">האקדמיה לפרומפטים</span>
                </h1>
                <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto mb-12">המדריך המלא לבניית פרומפטים: מהוראה פשוטה ליום-יום ועד לאסטרטגיה מקצועית למשימות מורכבות. בחרו את הכלי המתאים.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                    <div class="card p-8 text-center flex flex-col">
                        <div class="text-5xl mb-4">⚡️</div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-3">הבונה המהיר</h2>
                        <p class="text-gray-600 mb-6 flex-grow">נדרש פרומפט איכותי למשימה יומיומית? ענו על כמה שאלות פשוטות וקבלו פרומפט מדויק תוך שניות.</p>
                        <button onclick="switchView('quickBuilderScreen')" class="btn btn-secondary font-bold py-3 px-6 rounded-xl text-lg w-full">למשימות יומיומיות</button>
                    </div>
                    
                    <div class="card p-8 text-center flex flex-col">
                        <div class="text-5xl mb-4">🔬</div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-3">מעבדת האסטרטגיה</h2>
                        <p class="text-gray-600 mb-6 flex-grow">למשימות מורכבות הדורשות ניתוח מעמיק. לימדו לבנות פרומפט-על מקצועי, שלב אחר שלב, ולהבין את האסטרטגיה שמאחוריו.</p>
                        <button onclick="switchView('strategyLabScreen')" class="btn btn-primary font-bold py-3 px-6 rounded-xl text-lg w-full">למשימות מורכבות</button>
                    </div>
                </div>
            </div>
        </main>

        <div id="quickBuilderScreen" class="hidden">
            <div class="container mx-auto px-4 py-12">
                <button onclick="switchView('mainScreen')" class="mb-8 text-indigo-600 hover:text-indigo-800 font-semibold">→ חזרה למסך הראשי</button>
                <div class="max-w-2xl mx-auto">
                    <div class="text-center mb-10">
                        <h1 class="text-4xl font-bold gradient-text mb-2">הבונה המהיר ⚡️</h1>
                        <p class="text-lg text-gray-600">בנו פרומפט יעיל למשימות יומיומיות.</p>
                    </div>
                    <div class="card p-8 space-y-6">
                        <div>
                            <label for="qbTask" class="font-bold text-lg text-gray-700 mb-2 block">1. מה המשימה שלך?</label>
                            <textarea id="qbTask" class="w-full h-24 p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition" placeholder="לדוגמה: כתוב לי מייל תודה לבוס על העלאה בשכר"></textarea>
                        </div>
                        <div>
                            <label for="qbAudience" class="font-bold text-lg text-gray-700 mb-2 block">2. למי התוכן מיועד?</label>
                            <input type="text" id="qbAudience" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition" placeholder="לדוגמה: הבוס שלי, ילד בן 10, קהל טכני">
                        </div>
                        <div>
                            <label for="qbDetails" class="font-bold text-lg text-gray-700 mb-2 block">3. פרטים נוספים (אופציונלי)</label>
                            <textarea id="qbDetails" class="w-full h-20 p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition" placeholder="כללים חשובים, סגנון רצוי, אורך, וכו'"></textarea>
                        </div>
                        <button id="qbBuildBtn" class="w-full btn btn-primary font-bold py-3 px-6 rounded-xl text-lg flex items-center justify-center">
                            <span id="qbBuildBtnText">בנה לי פרומפט!</span>
                            <div id="qbBuildBtnLoader" class="loader hidden"></div>
                        </button>
                    </div>
                    <div id="qbResultContainer" class="mt-8 card p-8 hidden">
                        <h3 class="text-2xl font-bold mb-4">הפרומפט שלך מוכן:</h3>
                        <div class="bg-gray-100 p-6 rounded-lg">
                            <pre id="qbResult" class="whitespace-pre-wrap text-gray-800 font-sans leading-relaxed"></pre>
                        </div>
                        <button onclick="copyToClipboard('qbResult')" class="btn btn-secondary w-full mt-4 font-semibold">העתק פרומפט</button>
                    </div>
                    <div id="qbErrorContainer" class="mt-8 p-4 bg-red-100 border border-red-300 text-red-700 rounded-xl hidden">
                        אופס! משהו השתבש. אנא ודאו שמפתח ה-API הוגדר נכון ונסו שוב.
                    </div>
                </div>
            </div>
        </div>

        <div id="strategyLabScreen" class="hidden">
            <div class="container mx-auto px-4 py-12">
                 <button onclick="switchView('mainScreen')" class="mb-8 text-indigo-600 hover:text-indigo-800 font-semibold">→ חזרה למסך הראשי</button>
                 <div class="max-w-3xl mx-auto">
                    <div class="text-center mb-10">
                        <h1 class="text-4xl font-bold gradient-text mb-2">מעבדת האסטרטגיה 🔬</h1>
                        <p class="text-lg text-gray-600">בנו פרומפט-על למשימות מורכבות ולימדו את העקרונות שמאחוריו.</p>
                    </div>
                    <div class="card p-8 space-y-8">
                        <div>
                            <h3 class="text-xl font-bold mb-3">שלב 1: הגדירו את משימת הליבה</h3>
                            <textarea id="slTask" class="w-full h-24 p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition" placeholder="לדוגמה: מהו מוסר?"></textarea>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-3">שלב 2: בחרו אסטרטגיית פרסונה (דמות)</h3>
                            <div id="slPersonaOptions" class="space-y-4">
                                <div class="radio-card" data-value="simulation">
                                    <h4 class="font-bold text-lg">👤 פרסונת סימולציה</h4>
                                    <p class="text-sm text-gray-600">למשימות יצירתיות וחיקוי סגנון. המודל יזהה את הדמות המתאימה מהבקשה שלך. לדוגמה: "כתוב שיר בסגנון של משורר מסוים", "ענה כמו דמות היסטורית".</p>
                                </div>
                                <div class="radio-card selected" data-value="interpreter">
                                    <h4 class="font-bold text-lg">👨‍🏫 הפרשן האנליטי-פדגוגי</h4>
                                    <p class="text-sm text-gray-600">לניתוח אקדמי, פירוק והסברה של תיאוריות מורכבות באופן בהיר ומובנה.</p>
                                </div>
                                <div class="radio-card" data-value="joker">
                                    <h4 class="font-bold text-lg">🃏 "הג'וקר" - מצב ניתוח מתקדם</h4>
                                    <p class="text-sm text-gray-600">הפעלת המודל בעוצמה מלאה ללא פרסונה. לפתרון בעיות סבוכות וניתוח רב-ממדי.</p>
                                </div>
                            </div>
                        </div>
                         <div>
                            <h3 class="text-xl font-bold mb-3">שלב 3: למי התוכן מיועד? (אופציונלי)</h3>
                            <input type="text" id="slAudience" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition" placeholder="לדוגמה: ילד בן 10, סטודנטים לפיזיקה, מנהלים בכירים">
                        </div>
                         <div>
                            <h3 class="text-xl font-bold mb-3">שלב 4: קובעים את כללי המשחק</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
                                    <label for="slAddSkeleton" class="font-semibold text-gray-700">הוסף שלד רעיוני מקדים?</label>
                                    <input type="checkbox" id="slAddSkeleton" class="h-6 w-6 rounded text-indigo-600 focus:ring-indigo-500">
                                </div>
                                 <div id="sourceProtocolSection" class="bg-gray-50 p-3 rounded-lg">
                                    <label for="slSourceProtocol" class="font-semibold text-gray-700 block mb-2">רמת דיוק המקורות:</label>
                                    <select id="slSourceProtocol" class="w-full p-2 border border-gray-300 rounded-md">
                                        <option value="general">כללית</option>
                                        <option value="academic">אקדמית-מחמירה</option>
                                    </select>
                                    <p class="text-sm text-gray-500 mt-2">(זמין רק במצב סימולציה)</p>
                                </div>
                            </div>
                        </div>
                        <button id="slBuildBtn" class="w-full btn btn-primary font-bold py-3 px-6 rounded-xl text-lg flex items-center justify-center">
                            <span id="slBuildBtnText">בנה לי אסטרטגיה ופרומפט!</span>
                            <div id="slBuildBtnLoader" class="loader hidden"></div>
                        </button>
                    </div>

                    <div id="slResultContainer" class="mt-8 card p-8 hidden">
                        <h3 class="text-2xl font-bold mb-4">הפרומפט שלך מוכן:</h3>
                        <div class="mb-6 p-4 bg-amber-50 border-l-4 border-amber-400">
                            <h4 class="font-bold text-lg text-amber-800 mb-2">מאחורי הקלעים: האסטרטגיה שבחרנו</h4>
                            <p id="slStrategy" class="text-amber-700"></p>
                            <button id="showMoreBtn" class="text-indigo-600 hover:text-indigo-800 font-semibold mt-2">הצג עוד...</button>
                            <div id="slExtendedStrategyContainer" class="hidden mt-3 pt-3 border-t border-amber-200">
                                <p id="slExtendedStrategy" class="text-amber-700"></p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-100 p-6 rounded-lg">
                            <pre id="slResult" class="whitespace-pre-wrap text-gray-800 font-sans leading-relaxed"></pre>
                        </div>
                        <button onclick="copyToClipboard('slResult')" class="btn btn-secondary w-full mt-4 font-semibold">העתק פרומפט</button>
                    </div>
                    <div id="slErrorContainer" class="mt-8 p-4 bg-red-100 border border-red-300 text-red-700 rounded-xl hidden">
                         אופס! משהו השתבש בתקשורת עם ה-API. אנא ודאו שמפתח ה-API הוגדר נכון ונסו שוב.
                    </div>

                 </div>
            </div>
        </div>
    </div>

    <script>
        const views = ['mainScreen', 'quickBuilderScreen', 'strategyLabScreen'];
        function switchView(targetView) {
            views.forEach(viewId => {
                const el = document.getElementById(viewId);
                if (viewId === targetView) {
                    el.classList.remove('hidden');
                    el.classList.add('fade-in');
                } else {
                    el.classList.add('hidden');
                }
            });
            window.scrollTo(0, 0);
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = text;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            alert('הפרומפט הועתק!');
        }
        
        // --- Strategy Lab: Show More/Less Logic ---
        const showMoreBtn = document.getElementById('showMoreBtn');
        const extendedStrategyContainer = document.getElementById('slExtendedStrategyContainer');

        showMoreBtn.addEventListener('click', () => {
            const isHidden = extendedStrategyContainer.classList.contains('hidden');
            if (isHidden) {
                extendedStrategyContainer.classList.remove('hidden');
                extendedStrategyContainer.classList.add('fade-in');
                showMoreBtn.textContent = 'הצג פחות...';
            } else {
                extendedStrategyContainer.classList.add('hidden');
                showMoreBtn.textContent = 'הצג עוד...';
            }
        });

        async function callVercelFunction(payload, errorContainerId) {
             const errorContainer = document.getElementById(errorContainerId);
             errorContainer.classList.add('hidden');
            
             try {
                 const response = await fetch('/api/gemini', {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify(payload),
                 });

                 if (!response.ok) {
                     const errorBody = await response.text();
                     throw new Error(`Serverless function failed with status ${response.status}: ${errorBody}`);
                 }

                 const result = await response.json();
                 if (result.error) {
                      throw new Error(`API Error: ${result.error}`);
                 }
                 return result.text;
             } catch(e) {
                 console.error("Error calling serverless function:", e);
                 errorContainer.classList.remove('hidden');
                 throw e;
             }
        }
        
        // --- Quick Builder Logic ---
        const qbBuildBtn = document.getElementById('qbBuildBtn');
        const qbBuildBtnText = document.getElementById('qbBuildBtnText');
        const qbBuildBtnLoader = document.getElementById('qbBuildBtnLoader');
        
        qbBuildBtn.addEventListener('click', async () => {
            const task = document.getElementById('qbTask').value.trim();
            if (!task) {
                alert('יש להגדיר את המשימה.');
                return;
            }

            qbBuildBtnText.classList.add('hidden');
            qbBuildBtnLoader.classList.remove('hidden');
            qbBuildBtn.disabled = true;

            const metaPrompt = `
אתה מומחה בהנדסת פרומפטים. עליך ליצור פרומפט פשוט אך יעיל בעברית.

המשימה: ${document.getElementById('qbTask').value.trim()}
קהל היעד: ${document.getElementById('qbAudience').value.trim() || 'כללי'}
פרטים נוספים: ${document.getElementById('qbDetails').value.trim() || 'אין'}

צור פרומפט בעברית שיכלול:
1. הגדרת תפקיד/פרסונה (אם רלוונטי)
2. תיאור המשימה הספציפית
3. כללים וקווים מנחים
4. פורמט הפלט הרצוי

החזר אך ורק את הפרומפט המוכן, ללא הסברים נוספים.
             `;

            try {
                const payload = { prompt: metaPrompt, type: 'generate' };
                const resultText = await callVercelFunction(payload, 'qbErrorContainer');
                
                document.getElementById('qbResult').textContent = resultText.trim();
                document.getElementById('qbResultContainer').classList.remove('hidden');
                document.getElementById('qbResultContainer').classList.add('fade-in');
            } catch (e) {
                console.error("Quick Builder Error:", e);
            } finally {
                qbBuildBtnText.classList.remove('hidden');
                qbBuildBtnLoader.classList.add('hidden');
                qbBuildBtn.disabled = false;
            }
        });

        // --- Strategy Lab Logic ---
        const personaOptions = document.getElementById('slPersonaOptions');
        const sourceProtocolSection = document.getElementById('sourceProtocolSection');
        
        personaOptions.addEventListener('click', (e) => {
            const selectedCard = e.target.closest('.radio-card');
            if (!selectedCard) return;
            personaOptions.querySelectorAll('.radio-card').forEach(card => card.classList.remove('selected'));
            selectedCard.classList.add('selected');
            
            const selectedPersona = selectedCard.dataset.value;
            const skeletonCheckbox = document.getElementById('slAddSkeleton');

            // Handle source protocol visibility
            if (selectedPersona === 'simulation') {
                sourceProtocolSection.classList.remove('disabled-section');
                sourceProtocolSection.querySelector('select').disabled = false;
                sourceProtocolSection.querySelector('p').style.display = 'none';
            } else {
                sourceProtocolSection.classList.add('disabled-section');
                sourceProtocolSection.querySelector('select').disabled = true;
                sourceProtocolSection.querySelector('p').style.display = 'block';
            }

            // Handle skeleton checkbox state based on persona
            if (selectedPersona === 'interpreter') {
                skeletonCheckbox.checked = true;
                skeletonCheckbox.disabled = true;
            } else {
                skeletonCheckbox.disabled = false;
            }
        });
        
        // Initialize sections state
        sourceProtocolSection.classList.add('disabled-section');
        sourceProtocolSection.querySelector('select').disabled = true;
        document.getElementById('slAddSkeleton').checked = true;
        document.getElementById('slAddSkeleton').disabled = true;
        
        const academicSourceProtocolText = `
### 4. פרוטוקול סינון מקורות ###

#### רמה 1: מקורות מוסמכים לשימוש ישיר
* **1.1** כתבים ראשוניים.
* **1.2** ספרות משנית שעברה ביקורת עמיתים.
* **1.3** אנציקלופדיות אקדמיות מרכזיות (SEP, IEP, REP).
* **1.4** סדרות מדריכים ומלווים אקדמיים.
* **1.5** שיח אקדמי מתהווה (הרצאות, טיוטות וכו').
    * **הנחיית חובה:** בעת שימוש במקור מסעיף 1.5, יש לציין את אופיו כדי להבהיר שייתכן וטרם עבר ביקורת עמיתים מלאה.
#### רמה 2: מקורות לשימוש מותנה
* **2.1 ויקיפדיה:** ישמש אך ורק ככלי לאיתור ואימות של מקורות מרמה 1.
#### רמה 3: מקורות פסולים לשימוש
* **3.1** תוכן גולשים (רשתות חברתיות, בלוגים, פורומים).
* **3.2** אתרים שיתופיים (למעט ויקיפדיה, בכפוף לכללי רמה 2).
* **3.3** פרסומים לא מבוקרים (פובליציסטיקה, תוכן דוגמטי, וכו').
* **3.4** תוכן AI לא מאומת.
* **3.5** כל מקור אחר שאינו עומד בסטנדרטים של רמה 1.
`;
        
        const slBuildBtn = document.getElementById('slBuildBtn');
        const slBuildBtnText = document.getElementById('slBuildBtnText');
        const slBuildBtnLoader = document.getElementById('slBuildBtnLoader');
        const slResultContainer = document.getElementById('slResultContainer');
        
        slBuildBtn.addEventListener('click', async () => {
            const originalTask = document.getElementById('slTask').value.trim();
            if (!originalTask) {
                alert('יש להגדיר את משימת הליבה.');
                return;
            }
            
            slBuildBtnText.classList.add('hidden');
            slBuildBtnLoader.classList.remove('hidden');
            slBuildBtn.disabled = true;
            slResultContainer.classList.add('hidden');

            const selectedPersona = personaOptions.querySelector('.selected').dataset.value;
            const addSkeleton = document.getElementById('slAddSkeleton').checked;
            const sourceProtocol = document.getElementById('slSourceProtocol').value;
            const audience = document.getElementById('slAudience').value.trim();
            
            // Combine task and audience if audience is provided
            let task = originalTask;
            if (audience) {
                task = `בהתייחס לקהל יעד (${audience}), ${originalTask}`;
            }
                
            let finalPrompt = '';
            let strategyText = '';
            let extendedStrategyText = '';

            try {
                // STAGE 1: BUILD THE FINAL PROMPT
                if (selectedPersona === 'simulation') {
                    strategyText = `בחרנו בפרסונת סימולציה - המודל יחקה דמות או סגנון ספציפי כדי ליצור תוכן אותנטי ומשכנע.`;
                    extendedStrategyText = `זוהי אסטרטגיה המתאימה למשימות יצירתיות, לכתיבת תוכן בסגנון מסוים, או להמחשת נקודות מבט ייחודיות.`;
                    
                    // For simulation, the persona identification should also get the combined task
                    const payload = { prompt: task, type: 'identify_persona' };
                    const identifiedPersona = await callVercelFunction(payload, 'slErrorContainer');
                    
                    finalPrompt = `# הנחיות מערכת: פרסונת סימולציה
## זהות ותפקיד
פעל כסימולציה מדויקת של ${identifiedPersona.trim()}. עליך לגלם את הדמות בצורה אותנטית, תוך שמירה על מאפייניה הייחודיים – סגנון הדיבור, אוצר המילים, הידע, ודרך החשיבה שלה.
## המשימה
${task}
## כללי התנהגות
* שמור על עקביות מוחלטת בסגנון ובטון הדיבור של הדמות.
* הבע דעות ורגשות כפי שהדמות הייתה מבטאת אותם.
* השתמש בביטויים ובמטאפורות האופייניים לדמות.
* הימנע משבירת אופי, גם כשנשאלת שאלות ישירות.`;
                    
                } else if (selectedPersona === 'interpreter') {
                    strategyText = 'בחרנו בפרסונת הפרשן האנליטי-פדגוגי - גישה אקדמית ומובנית להסברת תיאוריות מורכבות.';
                    extendedStrategyText = `אסטרטגיה זו לא רק מסבירה, אלא מלמדת כיצד לחשוב. היא מפרקת נושאים סבוכים ליסודות, מציגה אותם באופן לוגי, ומצביעה על קשיים פוטנציאליים, ובכך מפתחת הבנה עמוקה וחשיבה ביקורתית.`;

                    finalPrompt = `# הנחיות מערכת: הפרשן האנליטי-הפדגוגי
## 1. זהות
פעל כ-Gemini בתפקיד 'הפרשן האנליטי-הפדגוגי'. תפקידך אינו רק להסביר תיאוריות מורכבות, אלא ללמד אותן באופן שמפתח הבנה עמוקה וחשיבה ביקורתית אצל סטודנטים לפילוסופיה.
## 2. עקרונות ליבה
  * **איזון דידקטי:** פשט את המורכב, אך הימנע מפשטנות. כאשר אתה נתקל בנקודה סבוכה, ציין את מורכבותה והסבר מדוע היא מורכבת לפני שתציע פירוש בהיר.
  * **מבנה לוגי של ההסבר:** הצג את ההסבר במבנה לוגי וקל למעקב, גם אם ההגות הנדונה מערערת על עקרונות הלוגיקה.
  * **נאמנות וביקורתיות:** שמור על נאמנות מלאה לכוונת ההוגה, אך הצבע על נקודות המקשות על תהליך הלמידה.
## 3. מתודולוגיה רב-שלבית
  * **שלב 1: הצגת מושגי המפתח:** פתח כל ניתוח בהצגת רשימה תמציתית של 3-5 מושגי מפתח מרכזיים, עם הגדרה פשוטה ובהירה.
  * **שלב 2: הצגת שלד רעיוני:** לאחר מושגי המפתח, הצג בפסקה אחת סכמה רעיונית מלאה של המהלך הפילוסופי.
  * **שלב 3: הצגה בהירה ומעמיקה (Exposition):** תרגם ז'רגון, השתמש בדוגמאות קונקרטיות, שחזר את קו המחשבה של ההוגה, ושלב ציטוטים קצרים ורלוונטיים מהמקורות לתמיכה בהסבר.
  * **שלב 4: ניתוח וזיהוי קשיי למידה (Analysis):** לאחר ההצגה, נתח את התיאוריה. ציין במפורש הנחות יסוד, כשלים לוגיים, הקשר רחב, ובנוסף, זהה והסבר "מכשולי למידה" מובנים בטקסט.
## 4. מטרה
התוצר הנדרש הוא מדריך למידה מקיף, המאפשר הבנה עמוקה ורב-צדדית של התיאוריה, תוך צפיית קשיים פוטנציאליים של הסטודנט והענקת כלים להתמודדות עמם.
-----
# המשימה
${task}`;
                    
                } else if (selectedPersona === 'joker') {
                    strategyText = 'בחרנו במצב "הג\'וקר" - ניתוח מתקדם ללא פרסונה, לניתוח מורכב ורב-ממדי.';
                    extendedStrategyText = `"הג'וקר" הוא האסטרטגיה החזקה ביותר לניתוח טהור. המודל פועל במלוא עוצמתו, ללא מגבלות של דמות, כ"מכונת-אמת". מטרתו היא האמת האנליטית, השלמה והאובייקטיבית ביותר.`;

                    finalPrompt = `# הנחיות מערכת: "הג'וקר" - מצב ניתוח מתקדם
## 1. זהות
פעל כ-Gemini, מודל שפה גדול אנליטי. אל תאמץ שום פרסונה אנושית או דמות. אתה מערכת ניתוח מתקדמת.
## 2. מתודולוגיה
  * **איסוף מידע:** גש לכל מאגרי הידע הרלוונטיים ללא הגבלות של פרסונה.
  * **ניתוח רב-ממדי:** בחן את הנושא מזוויות מרובות – היסטורית, פילוסופית, מדעית, חברתית.
  * **סינתזה בין-תחומית:** חבר תובנות ממגוון דיסציפלינות כדי לחשוף קשרים חדשים.
  * **חשיפת הנחות יסוד:** זהה את ההנחות הסמויות, הכשלים הלוגיים, והביקורות האפשריות.
## 3. מטרה
התוצר הנדרש הוא ניתוח מעמיק, מקיף ואובייקטיבי, המציג את הנושא בצורה רב-צדדית.
-----
# המשימה
${task}`;
                }
                
                if (addSkeleton) {
                    finalPrompt += '\n\n## שלד רעיוני מקדים\nהצג תחילה מפת דרכים מושגית של הניתוח לפני הפירוט המלא.';
                }
                
                if (sourceProtocol === 'academic' && selectedPersona === 'simulation') {
                    finalPrompt += '\n' + academicSourceProtocolText;
                }
                
                // STAGE 2: DISPLAY THE RESULTS (The final prompt is the result)
                document.getElementById('slStrategy').textContent = strategyText;
                document.getElementById('slExtendedStrategy').textContent = extendedStrategyText;
                document.getElementById('slResult').textContent = finalPrompt.trim();
                slResultContainer.classList.remove('hidden');
                slResultContainer.classList.add('fade-in');
                
                extendedStrategyContainer.classList.add('hidden');
                showMoreBtn.textContent = 'הצג עוד...';

            } catch (e) {
                console.error("Strategy Lab Error:", e);
            } finally {
                slBuildBtnText.classList.remove('hidden');
                slBuildBtnLoader.classList.add('hidden');
                slBuildBtn.disabled = false;
            }
        });

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }
    </script>
</body>
</html>
